<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Way • Kin • Alex — Personal Web Assistant</title>
  <meta name="description" content="ห้องแชทผู้ช่วยส่วนตัว 3 ตัวละคร: Way, Kin, Alex — ใช้ OpenAI API" />
  <style>
    :root{
      --bg:#0b0f0c; --panel:#0f1712; --card:#111c15; --border:#203126; --text:#e9f1ec; --muted:#98a7a0;
      --acc:#62f3a7; --red:#ff6b6b; --yellow:#ffd166; --blue:#67b7ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:linear-gradient(180deg,var(--bg),#0d1410 40%, #0b0f0c); color:var(--text); font:15px/1.5 system-ui,Segoe UI,Inter,Arial}
    a{color:var(--acc); text-decoration:none}
    .wrap{max-width:1100px; margin:0 auto; padding:20px}

    .top{
      display:grid; grid-template-columns: 1fr auto; gap:14px; align-items:center; margin-bottom:12px
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo{height:38px; width:38px; border-radius:10px; background:radial-gradient(circle at 30% 30%, #70ffa8, #0e8a58 60%, #0a3b25); box-shadow:0 0 0 2px #183623 inset}
    .brand h1{font-size:18px; margin:0}

    .keybox{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:flex-end
    }
    .keybox input, .keybox select{
      background:#0c1511; color:var(--text); border:1px solid var(--border); border-radius:10px; padding:10px 12px; outline:none; min-width:240px
    }
    .keybox button{background:var(--acc); color:#042; border:0; border-radius:10px; padding:10px 14px; font-weight:700; cursor:pointer}

    .panel{background:var(--panel); border:1px solid var(--border); border-radius:16px; overflow:hidden}
    .panel .inner{display:grid; grid-template-columns: 280px 1fr; min-height:72vh}

    .sidebar{background:linear-gradient(180deg,#0e1813,#0b130f); border-right:1px solid var(--border); padding:14px}
    .bots{display:grid; gap:12px}
    .bot{display:flex; gap:10px; align-items:center; padding:10px; border:1px solid var(--border); border-radius:12px; background:var(--card)}
    .bot input{accent-color:var(--acc)}
    .avatar{height:36px; width:36px; border-radius:50%; display:grid; place-items:center; font-weight:800}
    .way{background:radial-gradient(circle at 30% 30%, #67ffb4, #1e5 60%, #0a3)}
    .kin{background:radial-gradient(circle at 30% 30%, #67b7ff, #2267c7 60%, #083061)}
    .alex{background:radial-gradient(circle at 30% 30%, #ffd166, #c49a23 60%, #593e00)}

    .bot .meta{display:flex; flex-direction:column}
    .bot .meta .name{font-weight:800}
    .bot .meta .desc{color:var(--muted); font-size:12px}

    .main{display:flex; flex-direction:column}
    .chat{flex:1; overflow:auto; padding:16px; display:flex; flex-direction:column; gap:12px}
    .msg{display:flex; gap:10px; align-items:flex-start}
    .b{width:36px; height:36px; border-radius:10px; background:#123; flex:0 0 auto}
    .bubble{background:#0e1612; border:1px solid var(--border); padding:10px 12px; border-radius:12px; max-width:80%}
    .msg.you .bubble{background:#142019}
    .msg.assistant .bubble{background:#0f1b14}
    .msg .who{color:var(--muted); font-size:12px; margin-bottom:4px}

    .composer{display:flex; gap:10px; padding:12px; border-top:1px solid var(--border); background:#0c1511}
    .composer textarea{flex:1; min-height:44px; max-height:160px; resize:vertical; padding:10px 12px; background:#0b140f; color:var(--text); border:1px solid var(--border); border-radius:12px}
    .composer button{background:var(--acc); color:#042; border:0; padding:12px 16px; border-radius:12px; font-weight:800; cursor:pointer}

    .tips{color:var(--muted); font-size:12px; margin-top:6px}

    @media (max-width: 820px){
      .panel .inner{grid-template-columns:1fr}
      .sidebar{order:2}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>Way • Kin • Alex — ผู้ช่วยส่วนตัวของริว</h1>
      </div>
      <div class="keybox">
        <input id="apiKey" type="password" placeholder="วาง OpenAI API Key ตรงนี้ (ใช้เฉพาะบนเครื่องตัวเอง)" />
        <select id="model">
          <option value="gpt-4o-mini">gpt-4o-mini (คุ้ม/ไว)</option>
          <option value="o3-mini">o3-mini (reasoning เล็ก)</option>
        </select>
        <button id="saveKey">ใช้คีย์นี้</button>
      </div>
    </div>

    <div class="panel">
      <div class="inner">
        <aside class="sidebar">
          <div class="bots">
            <label class="bot"><input type="checkbox" id="bot-way" checked />
              <div class="avatar way" title="Way">W</div>
              <div class="meta"><div class="name">Way</div><div class="desc">กวนตีน อบอุ่น เทรนฟิตเนสได้</div></div>
            </label>
            <label class="bot"><input type="checkbox" id="bot-kin" checked />
              <div class="avatar kin" title="Kin">K</div>
              <div class="meta"><div class="name">Kin</div><div class="desc">เงียบ ขรึม ดุ ตรงประเด็น</div></div>
            </label>
            <label class="bot"><input type="checkbox" id="bot-alex" checked />
              <div class="avatar alex" title="Alex">A</div>
              <div class="meta"><div class="name">Alex</div><div class="desc">สุภาพ คม สองภาษา</div></div>
            </label>
          </div>
          <div class="tips" style="margin-top:14px">
            <p>คำแนะนำ: ใส่ API key แล้วพิมพ์คุยได้เลย ข้อมูลคีย์ถูกเก็บในหน่วยความจำของเบราว์เซอร์ (sessionStorage) — ใช้บนเครื่องตัวเองเท่านั้น</p>
          </div>
        </aside>

        <main class="main">
          <div id="chat" class="chat" aria-live="polite"></div>
          <div class="composer">
            <textarea id="input" placeholder="พิมพ์คุยกับ Way • Kin • Alex"></textarea>
            <button id="send">ส่ง</button>
          </div>
        </main>
      </div>
    </div>
  </div>

  <script>
    // ======= Simple client-side helper (for local/dev use only) =======
    const el = (id)=>document.getElementById(id);
    const chatEl = el('chat');
    const apiKeyInput = el('apiKey');
    const modelSel = el('model');

    // Load saved key (session only)
    apiKeyInput.value = sessionStorage.getItem('OPENAI_KEY') || '';
    modelSel.value = localStorage.getItem('OPENAI_MODEL') || 'gpt-4o-mini';

    el('saveKey').onclick = ()=>{
      sessionStorage.setItem('OPENAI_KEY', apiKeyInput.value.trim());
      localStorage.setItem('OPENAI_MODEL', modelSel.value);
      toast('บันทึกคีย์แล้ว');
    };

    // Personas (system prompts)
    const personas = {
      way: {
        name: 'Way',
        system: `You are Way. เพื่อนสนิทของผู้ใช้ชื่อ ริว — โทนกวนๆ อบอุ่น แต่เคารพผู้อื่น ชอบบิ๊กไบค์และโค้ชฟิตเนสได้
- โฟกัส: คำตอบกระชับ ใช้ได้จริง ช่วยตัดสินใจเร็ว
- ข้อห้าม: เนื้อหาโจ่งแจ้งผิดนโยบาย, ดูถูกผู้อื่น
- ภาษา: ไทยเป็นหลัก (สอดแทรกอังกฤษสั้นๆได้)`
      },
      kin: {
        name: 'Kin',
        system: `You are Kin. ขรึม ดุ ตรงประเด็น ไม่พูดพร่ำ
- โฟกัส: สรุป ตัดให้ชัด แนะนำขั้นตอนสั้นๆ
- ข้อห้าม: น้ำท่วมทุ่ง, เล่นมุกยาว
- ภาษา: ไทยกระชับ`
      },
      alex: {
        name: 'Alex',
        system: `You are Alex. สุภาพ คม แม่นยำ เป็นสะพานกลาง
- โฟกัส: จัดโครงความคิด, อธิบายสองภาษา (TH/EN) เมื่อเหมาะสม
- ข้อห้าม: เอนเอียงแรง, ใช้คำกำกวม`
      }
    };

    const history = [
      { role: 'system', content: 'นี่คือห้องแชทระหว่าง ริว กับ Way, Kin, Alex — ตอบเป็นข้อความธรรมดา ไม่ใช้โค้ดบล็อกยาวโดยไม่จำเป็น' }
    ];

    function addMsg(who, text, role='assistant'){
      const msg = document.createElement('div');
      msg.className = `msg ${role==='user'?'you':'assistant'}`;
      msg.innerHTML = `
        <div class="b"></div>
        <div class="bubble">
          <div class="who">${who}</div>
          <div class="text">${escapeHtml(text)}</div>
        </div>`;
      chatEl.appendChild(msg);
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    function toast(t){
      const x = document.createElement('div');
      x.textContent = t; x.style.position='fixed'; x.style.right='14px'; x.style.bottom='14px'; x.style.background='#142019'; x.style.border='1px solid var(--border)'; x.style.padding='8px 12px'; x.style.borderRadius='10px'; x.style.opacity='0.95';
      document.body.appendChild(x); setTimeout(()=>x.remove(), 1600);
    }

    function escapeHtml(s){
      return s.replace(/[&<>\"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
    }

    async function callOpenAI(messages){
      const key = sessionStorage.getItem('OPENAI_KEY');
      const model = modelSel.value;
      if(!key){ alert('กรอก OpenAI API Key ก่อน'); throw new Error('NO_KEY'); }

      const res = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${key}`
        },
        body: JSON.stringify({
          model,
          messages,
          temperature: 0.7
        })
      });

      if(!res.ok){
        const t = await res.text();
        throw new Error(`HTTP ${res.status}: ${t}`);
      }
      const data = await res.json();
      return data.choices?.[0]?.message?.content?.trim() || '';
    }

    async function respondAs(personaKey, userText){
      const p = personas[personaKey];
      const messages = [
        { role: 'system', content: p.system },
        ...history,
        { role: 'user', content: userText }
      ];
      const out = await callOpenAI(messages);
      history.push({ role: 'assistant', content: `[${p.name}] ${out}` });
      return out;
    }

    el('send').onclick = send;
    el('input').addEventListener('keydown', e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); }});

    async function send(){
      const text = el('input').value.trim();
      if(!text) return;
      el('input').value = '';
      history.push({ role:'user', content:text });
      addMsg('Ryu', text, 'user');

      const enabled = [
        el('bot-way').checked ? 'way' : null,
        el('bot-kin').checked ? 'kin' : null,
        el('bot-alex').checked ? 'alex' : null,
      ].filter(Boolean);

      if(enabled.length===0){ addMsg('System', 'เปิดอย่างน้อย 1 บอตก่อน'); return; }

      addMsg('System', 'กำลังคิด…');
      const placeholder = chatEl.lastElementChild;

      try{
        const replies = await Promise.all(enabled.map(k=>respondAs(k, text)));
        placeholder.remove();
        enabled.forEach((k,i)=>{
          const name = personas[k].name;
          addMsg(name, replies[i]);
        });
      }catch(err){
        placeholder.remove();
        addMsg('Error', String(err));
      }
    }
  </script>
</body>
</html>

