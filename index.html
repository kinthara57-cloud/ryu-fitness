<!--
EV Lite AI Assistant ‚Äî Drop-in Chat Widget (Frontend) + Serverless API examples
- Frontend: index.html (this file)
- Serverless backends included below as code blocks (Cloudflare Workers, Vercel)
-->
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EV Lite AI Assistant</title>
  <style>
    :root{ --bg:#0a0f0b; --panel:#0f1a12; --text:#f8fff6; --muted:#b9d0bd; --border:#203326; --accent:#ffd166; --brand:#36c06b; }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,Segoe UI,Prompt,sans-serif; background:linear-gradient(180deg,#0a0f0b,#0f1a12); color:var(--text)}
    .wrap{max-width:980px;margin:auto;padding:20px}
    .card{background:#0f1a12;border:1px solid var(--border);border-radius:16px;padding:16px}
    .btn{padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#14241a;color:#fff;cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,#e53935,#36c06b);border:none;color:#1b0d0d;font-weight:800}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}

    /* Floating chat widget */
    .evai{position:fixed; right:18px; bottom:18px; z-index:50}
    .evai-btn{width:56px;height:56px;border-radius:999px;display:grid;place-items:center;background:linear-gradient(90deg,#e53935,#36c06b);border:none;box-shadow:0 10px 30px rgba(0,0,0,.4); cursor:pointer}
    .evai-panel{position:fixed; right:18px; bottom:86px; width:min(380px,94vw); height:520px; display:none}
    .evai-panel.show{display:block}
    .evai-box{background:#0e1712cc; backdrop-filter:blur(8px); border:1px solid var(--border); border-radius:16px; box-shadow:0 20px 60px rgba(0,0,0,.55); height:100%; display:flex; flex-direction:column}
    .evai-head{padding:12px 14px; border-bottom:1px solid rgba(255,255,255,.06); display:flex; align-items:center; justify-content:space-between}
    .evai-title{font-weight:900; letter-spacing:.3px}
    .evai-body{padding:12px; flex:1; overflow:auto; display:flex; flex-direction:column; gap:10px}
    .msg{display:flex; gap:8px}
    .msg .bubble{max-width:86%; padding:10px 12px; border-radius:12px; border:1px solid var(--border)}
    .msg.user{justify-content:flex-end}
    .msg.user .bubble{background:#132319}
    .msg.bot .bubble{background:#101d15}
    .evai-input{display:flex; gap:8px; padding:10px; border-top:1px solid rgba(255,255,255,.06)}
    .evai-input input{flex:1; background:#0f1a13; border:1px solid var(--border); color:#fff; padding:10px; border-radius:10px}
    .tiny{color:var(--muted); font-size:12px}
    code.inline{background:#0f1a13;border:1px solid var(--border);border-radius:6px;padding:1px 6px}
  </style>
</head>
<body>
<div class="wrap">
  <h1 style="margin:0">EV Lite AI Assistant</h1>
  <p class="tiny">‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡∏•‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏î‡πÜ ‡∏Ç‡∏≠‡∏á‡∏£‡∏¥‡∏ß ‡∏Å‡πá‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÅ‡∏ä‡∏ï‡∏ö‡∏≠‡∏ó AI ‡∏ï‡∏≠‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ú‡πà‡∏≤‡∏ô <code class="inline">/api/ai</code> (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÅ‡∏ö‡πá‡∏Å‡πÄ‡∏≠‡∏ô‡∏î‡πå‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡πà‡∏≠‡∏ô API key)</p>

  <div class="card">
    <h3 style="margin-top:0">‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô 3 ‡∏Ç‡∏±‡πâ‡∏ô</h3>
    <ol>
      <li>‡∏î‡∏µ‡∏û‡∏•‡∏≠‡∏¢‡πÅ‡∏ö‡πá‡∏Å‡πÄ‡∏≠‡∏ô‡∏î‡πå (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á: Cloudflare Workers ‡∏´‡∏£‡∏∑‡∏≠ Vercel)</li>
      <li>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Environment: <code class="inline">OPENAI_API_KEY</code> ‡∏´‡∏£‡∏∑‡∏≠ <code class="inline">GEMINI_API_KEY</code></li>
      <li>‡∏ß‡∏≤‡∏á‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ß‡∏¥‡∏à‡πÄ‡∏à‡πá‡∏ï (‡∏≠‡∏¢‡∏π‡πà‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå) ‡∏•‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏Å‡πâ <code class="inline">API_BASE</code> ‡πÉ‡∏´‡πâ‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏¥‡∏ß</li>
    </ol>
  </div>

  <div class="card" style="margin-top:12px">
    <h3 style="margin-top:0">System Prompt (‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ)</h3>
    <pre style="white-space:pre-wrap;background:#0f1a13;border:1px solid var(--border);border-radius:12px;padding:10px">‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô EV Lite AI Assistant ‡∏û‡∏π‡∏î‡πÑ‡∏ó‡∏¢ ‡∏ô‡πâ‡∏≥‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏ô‡∏¥‡∏ó ‡∏™‡∏∏‡∏†‡∏≤‡∏û‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:
- ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏™‡∏ï‡πá‡∏≠‡∏Å/‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
- ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à ‡∏£‡∏≤‡∏Ñ‡∏≤ ‡πÅ‡∏•‡∏∞‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏≤‡∏Å‡∏°‡∏µ
- ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï ‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏ô‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå</pre>
  </div>

  <div class="card" style="margin-top:12px">
    <h3 style="margin-top:0">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏ö‡πá‡∏Å‡πÄ‡∏≠‡∏ô‡∏î‡πå ‚Äî Cloudflare Workers (Node-compatible)</h3>
    <p class="tiny">‡πÑ‡∏ü‡∏•‡πå <code class="inline">worker.js</code> ‚Ä¢ ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏£‡∏∏‡πà‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏• <code class="inline">gpt-4.1-mini</code> ‡∏´‡∏£‡∏∑‡∏≠ <code class="inline">gpt-4o-mini</code> ‡πÑ‡∏î‡πâ</p>
    <pre style="white-space:pre-wrap;background:#0f1a13;border:1px solid var(--border);border-radius:12px;padding:10px">export default {
  async fetch(req, env) {
    if (new URL(req.url).pathname !== '/api/ai') return new Response('Not found', {status:404});
    if (req.method !== 'POST') return new Response('Method Not Allowed', {status:405});

    const { messages } = await req.json();
    const sys = {
      role: 'system',
      content: '‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ EV Lite AI Assistant (‡πÑ‡∏ó‡∏¢) ‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ‡∏ï‡∏≠‡∏ö‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô'
    };

    const res = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${env.OPENAI_API_KEY}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        model: 'gpt-4.1-mini',
        messages: [sys, ...messages],
        temperature: 0.7
      })
    });

    if (!res.ok) return new Response(await res.text(), {status:res.status});
    const data = await res.json();
    const text = data.choices?.[0]?.message?.content || '';
    return new Response(JSON.stringify({ reply: text }), {headers: {'Content-Type':'application/json'}});
  }
}
// wrangler.toml:
// name = "ev-lite-ai"
// main = "worker.js"
// compatibility_date = "2025-11-01"
// [vars]
// # OPENAI_API_KEY set via dashboard secret</pre>
  </div>

  <div class="card" style="margin-top:12px">
    <h3 style="margin-top:0">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏ö‡πá‡∏Å‡πÄ‡∏≠‡∏ô‡∏î‡πå ‚Äî Vercel Serverless (Node 18+)</h3>
    <p class="tiny">‡πÑ‡∏ü‡∏•‡πå <code class="inline">api/ai.js</code> ‚Ä¢ ‡πÄ‡∏ã‡πá‡∏ï <code class="inline">OPENAI_API_KEY</code> ‡πÉ‡∏ô Vercel Dashboard</p>
    <pre style="white-space:pre-wrap;background:#0f1a13;border:1px solid var(--border);border-radius:12px;padding:10px">export default async function handler(req, res){
  if(req.method !== 'POST') return res.status(405).end();
  try{
    const { messages } = req.body || {};
    const sys = { role:'system', content:'‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ EV Lite AI Assistant (‡πÑ‡∏ó‡∏¢) ‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô' };
    const r = await fetch('https://api.openai.com/v1/chat/completions',{
      method:'POST',
      headers:{'Authorization':`Bearer ${process.env.OPENAI_API_KEY}`,'Content-Type':'application/json'},
      body:JSON.stringify({ model:'gpt-4.1-mini', messages:[sys, ...(messages||[])], temperature:0.7 })
    });
    if(!r.ok){ const t = await r.text(); return res.status(r.status).send(t); }
    const data = await r.json();
    res.json({ reply: data.choices?.[0]?.message?.content || '' });
  }catch(err){ res.status(500).json({ error: String(err) }); }
}
// vercel.json (optional)
// { "routes": [{ "src": "/api/ai", "dest": "api/ai.js" }] }</pre>
  </div>

  <div class="card" style="margin-top:12px">
    <h3 style="margin-top:0">‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: Google AI Studio (Gemini) ‡πÅ‡∏ó‡∏ô OpenAI</h3>
    <pre style="white-space:pre-wrap;background:#0f1a13;border:1px solid var(--border);border-radius:12px;padding:10px">// ‡πÉ‡∏ô‡πÅ‡∏ö‡πá‡∏Å‡πÄ‡∏≠‡∏ô‡∏î‡πå ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô endpoint:
const r = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key='+process.env.GEMINI_API_KEY,{
  method:'POST', headers:{'Content-Type':'application/json'},
  body: JSON.stringify({ contents: [{ role:'user', parts:[{text: messages.map(m=>`${m.role}: ${m.content}`).join('\n') }] }] })
});</pre>
  </div>

</div>

<!-- Floating AI Widget (Frontend) -->
<div class="evai">
  <button id="evaiBtn" class="evai-btn" title="‡∏ñ‡∏≤‡∏° AI">üí¨</button>
  <div id="evaiPanel" class="evai-panel">
    <div class="evai-box">
      <div class="evai-head">
        <div class="evai-title">EV AI Assistant</div>
        <button id="evaiClose" class="btn">‡∏õ‡∏¥‡∏î</button>
      </div>
      <div id="evaiBody" class="evai-body" aria-live="polite"></div>
      <div class="evai-input">
        <input id="evaiInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô ‡∏Ø‡∏•‡∏Ø..." />
        <button id="evaiSend" class="btn primary">‡∏™‡πà‡∏á</button>
      </div>
    </div>
  </div>
</div>

<script>
// ===== Frontend Chat Widget =====
const API_BASE = '/api/ai'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡∏µ‡πâ‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏¥‡∏ß‡∏ñ‡πâ‡∏≤‡∏î‡∏µ‡∏û‡∏•‡∏≠‡∏¢‡πÅ‡∏¢‡∏Å
const panel = document.getElementById('evaiPanel');
const bodyBox = document.getElementById('evaiBody');
const input = document.getElementById('evaiInput');
const btn = document.getElementById('evaiBtn');
const send = document.getElementById('evaiSend');
const closeBtn = document.getElementById('evaiClose');

btn.onclick = ()=> panel.classList.toggle('show');
closeBtn.onclick = ()=> panel.classList.remove('show');
input.addEventListener('keydown', e=>{ if(e.key==='Enter') send.click(); });

function addMsg(role, text){
  const row = document.createElement('div'); row.className = 'msg '+(role==='user'?'user':'bot');
  const b = document.createElement('div'); b.className='bubble'; b.textContent = text;
  row.appendChild(b); bodyBox.appendChild(row); bodyBox.scrollTop = bodyBox.scrollHeight;
}

async function askAI(text){
  addMsg('user', text);
  const thinking = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î‚Ä¶'; addMsg('bot', thinking);
  try{
    const res = await fetch(API_BASE, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ messages:[{role:'user', content:text}] }) });
    const data = await res.json();
    // ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ö‡πÄ‡∏ö‡∏¥‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (thinking) ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏£‡∏¥‡∏á
    bodyBox.lastChild.querySelector('.bubble').textContent = data.reply || '(‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö)';
  }catch(err){
    bodyBox.lastChild.querySelector('.bubble').textContent = '‡πÄ‡∏≠‡∏≠‡πÄ‡∏£‡∏≠‡∏£‡πå: '+String(err);
  }
}

send.onclick = ()=>{
  const q = (input.value||'').trim(); if(!q) return; input.value=''; askAI(q);
}

// ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÅ‡∏£‡∏Å
addMsg('bot', '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏à‡πâ‡∏≤ üëã ‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢');
</script>
</body>
</html>

